---
dns::local_cache: false
dns::nameservers:
  - 192.168.100.29
dns::search_domains:
  - internal.staging.swh.network

dns::forward_zones:
  'internal.softwareheritage.org.':
    - 192.168.100.29
  '100.168.192.in-addr.arpa.':
    - 192.168.100.29
  '101.168.192.in-addr.arpa.':
    - 192.168.100.29
  'internal.staging.swh.network':
    - 192.168.100.29
  '128.168.192.in-addr.arpa.':
    - 192.168.100.29

dns::forwarders:
  - 193.51.196.130
  - 193.51.196.131
dns::forwarder_insecure: true

ntp::servers:
  - sesi-ntp1.inria.fr
  - sesi-ntp2.inria.fr

internal_network: 192.168.128.0/24

smtp::relayhost: '[smtp.inria.fr]'

swh::deploy::storage::db::host: db0.internal.staging.swh.network
swh::deploy::storage::db::port: "%{alias('swh::deploy::db::pgbouncer::port')}"
swh::deploy::storage::db::user: swh
swh::deploy::storage::db::dbname: swh

swh::deploy::indexer::storage::db::host: db0.internal.staging.swh.network
swh::deploy::indexer::storage::db::port: "%{alias('swh::deploy::db::pgbouncer::port')}"
swh::deploy::indexer::storage::db::user: swh-indexer
swh::deploy::indexer::storage::db::dbname: swh-indexer

swh::deploy::scheduler::db::host: db0.internal.staging.swh.network
swh::deploy::scheduler::db::port: "%{alias('swh::deploy::db::pgbouncer::port')}"
swh::deploy::scheduler::db::dbname: swh-scheduler
swh::deploy::scheduler::db::user: swh-scheduler

swh::deploy::deposit::db::host: deposit.internal.staging.swh.network
swh::deploy::deposit::db::port: "%{alias('swh::deploy::db::pgbouncer::port')}"
swh::deploy::deposit::db::dbuser: swh-deposit
swh::deploy::deposit::db::dbname: swh-deposit

swh::deploy::worker::instances:
  - loader_git

#### Rabbitmq instance to use
# swh::deploy::worker::task_broker::password in private data
swh::deploy::worker::task_broker: "amqp://swhconsumer:%{hiera('swh::deploy::worker::task_broker::password')}@scheduler0.internal.staging.swh.network:5672//"

#### Storage/Indexer/Vault/Scheduler services to use in staging area

swh::remote_service::storage::config::storage0:
  cls: remote
  args:
    url: "http://storage0.internal.staging.swh.network:%{hiera('swh::remote_service::storage::port')}/"
swh::remote_service::storage::config: "%{alias('swh::remote_service::storage::config::storage0')}"
swh::remote_service::storage::config::writable: "%{alias('swh::remote_service::storage::config::storage0')}"

swh::remote_service::vault::config::vault0:
  cls: remote
  args:
    url: "http://vault0.internal.staging.swh.network:%{hiera('swh::remote_service::vault::port')}/"
swh::remote_service::vault::config: "%{alias('swh::remote_service::vault::config::vault0')}"
swh::remote_service::vault::config::writable: "%{alias('swh::remote_service::vault::config::vault0')}"

swh::remote_service::indexer::config::storage0:
  cls: remote
  args:
    url: "http://storage0.internal.staging.swh.network:%{hiera('swh::remote_service::indexer::port')}/"
swh::remote_service::indexer::config: "%{alias('swh::remote_service::indexer::config::storage0')}"
swh::remote_service::indexer::config::writable: "%{alias('swh::remote_service::indexer::config::storage0')}"

swh::remote_service::scheduler::config::scheduler0:
  cls: remote
  args:
    url: "http://scheduler0.internal.staging.swh.network:%{hiera('swh::remote_service::scheduler::port')}/"

swh::remote_service::scheduler::config: "%{alias('swh::remote_service::scheduler::config::scheduler0')}"
swh::remote_service::scheduler::config::writable: "%{alias('swh::remote_service::scheduler::config::scheduler0')}"

swh::deploy::worker::loader_git::config:
  storage: "%{alias('swh::remote_service::storage::config::writable')}"
  save_data: false
  directory_packet_size: 100
  celery:
    task_broker: "%{alias('swh::deploy::worker::task_broker')}"
    task_modules:
      - swh.loader.git.tasks
    task_queues:
      - swh.loader.git.tasks.UpdateGitRepository
      - swh.loader.git.tasks.LoadDiskGitRepository
      - swh.loader.git.tasks.UncompressAndLoadDiskGitRepository

